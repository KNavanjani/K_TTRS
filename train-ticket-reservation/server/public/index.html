<!DOCTYPE html>
<html>

<head>
    <meta charset="uft-8">
    <title>Train Ticket Reservation</title>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link href="/styles.css" rel="stylesheet" type="text/css">

</head>

<body>
    <h1 class="title">Train Ticket Reservation in Sri Lanka</h1>
    <div id="homepage">
        <h1>Search Available Trains</h1>
        <div id="trains">
        </div>
    </div>

    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/react@15/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>ï»¿

    <!--Create React Component-->
    <script type="text/babel">
        var Trains = React.createClass({

            getInitialState:function(){
                return ({
                    trains:[]

                });
            },

            render:function(){

                var trains = this.state.trains;
                trains = trains.map(function(train,index){
                    return(
                        <li key={index}>
                            <span className ={train.obj.departureLocation}></span>
                            <span className = "arrivalLocation">{train.obj.arrivalLocation}</span>
                            <span className = "type">{train.obj.type}</span>
                            <span className = "tclass">{train.obj.tclass}</span>
                            <span className = "facilities">{train.obj.facilities}</span>
                            </li>

                            );
                });

                return(
                    <div id="train-container">
                        <form id="search"  onSubmit={this.handleSubmit}>
                            <label>Enter Departure : </label>
                            <input type="text" ref="departureLocation" placeholder="Enter Departure Location" required/>

                            <label>Enter Arrival : </label>
                            <input type="text" ref="arrivalLocation" placeholder="Enter Arrival Location" required/>
                            
                            <label>Enter Train Type : </label>
                            <input type="text" ref="type" placeholder="Enter Train Type" required/>
                            
                            <label>Enter Train Class : </label>
                            <input type="text" ref="tclass" placeholder="Enter Train Class" required/>
                            
                            <label>Enter Facilities : </label>
                            <input type="text" ref="facilities" placeholder="Enter Facilities" required/>
                            
                            <input type="submit" value="Find Available Trains"/>

                            </form>
                            <ul>{trains}</ul>
                        </div>

                );
            },

            handleSubmit:function(e){
                e.preventDefault();
                var departureLocation = this.refs.departureLocation.value;
                var arrivalLocation = this.refs.arrivalLocation.value;
                var type = this.refs.type.value;
                var tclass = this.refs.tclass.value;
                var facilities = this.refs.facilities.value;

                fetch('/api/trains?departureLocation='+departureLocation+'&arrivalLocation='+arrivalLocation+'&type='+type+'&tclass='+tclass+'&facilities='+facilities).then(function(data){
                    return data.json();
                }).then( json => {
                    this.setState({trains: json});
                    console.log(json);
                });
            }
        });
            ReactDOM.render(<Trains />, document.getElementById('trains'));

    </script>

</body>

</html>